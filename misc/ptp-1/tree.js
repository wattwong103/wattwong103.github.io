function collapse(t){t.children&&(t._children=t.children,t._children.forEach(collapse),t.children=null)}function update(t){function r(t,r){return path=`M ${t.y} ${t.x}\n          C ${(t.y+r.y)/2} ${t.x},\n            ${(t.y+r.y)/2} ${r.x},\n            ${r.y} ${r.x}`,path}function n(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),update(t)}var e=treemap(root),a=e.descendants(),o=e.descendants().slice(1);a.forEach(function(t){t.y=180*t.depth});var l=svg.selectAll("g.node").data(a,function(t){return t.id||(t.id=++i)}),c=l.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+")"}).on("click",n),d=60,u=120;c.append("rect").attr("class","node").attr("width",u).attr("height",d).attr("x",0).attr("y",d/2*-1).attr("rx","5").style("fill",function(t){return t.data.fill}),c.append("text").attr("dy","-.35em").attr("x",function(){return 13}).attr("text-anchor",function(){return"start"}).text(function(t){return t.data.name}).append("tspan").attr("dy","1.75em").attr("x",function(){return 13}).text(function(t){return t.data.subname}),c.append("a").attr("target","_blank").attr("xlink:href",function(t){return t.data.url}).append("svg:text").attr("x",function(){return 13}).attr("dy","-.35em").attr("text-anchor",function(){return"start"}).text(function(t){return t.data.name}).style("fill: rgb(0, 0, 0)",function(t){return t.free?"black":"#999"}).style("fill-opacity",1e-6);var h=c.merge(l);h.transition().duration(duration).attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),h.select("circle.node").attr("r",10).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}).attr("cursor","pointer");var s=l.exit().transition().duration(duration).attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove();s.select("circle").attr("r",1e-6),s.select("text").style("fill-opacity",1e-6);var f=svg.selectAll("path.link").data(o,function(t){return t.id});f.enter().insert("path","g").attr("class","link").attr("d",function(){var n={x:t.x0,y:t.y0};return r(n,n)}).merge(f).transition().duration(duration).attr("d",function(t){return r(t,t.parent)});f.exit().transition().duration(duration).attr("d",function(){var n={x:t.x,y:t.y};return r(n,n)}).remove();a.forEach(function(t){t.x0=t.x,t.y0=t.y})}fetch("./data/ptp-1.json").then(t=>t.json()).then(t=>{console.log(t),(root=d3.hierarchy(t,function(t){return t.children})).x0=height/2,root.y0=0,root.children.forEach(collapse),update(root)});var root,margin={top:20,right:90,bottom:30,left:90},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,svg=d3.select("body").append("svg").attr("width",width+margin.right+margin.left).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),i=0,duration=750,treemap=d3.tree().size([height,width]);