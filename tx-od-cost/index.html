<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">

    <!--Page Title-->
    <title>NaviCity</title>

    <!--Meta Keywords and Description-->
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

    <!--Favicon-->
    <link rel="shortcut icon" href="images/favicon.ico" title="Favicon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />

    <!-- Main CSS Files -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Namari Color CSS -->
    <link rel="stylesheet" href="css/namari-color.css">

    <!--Icon Fonts - Font Awesome Icons-->
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- Animate CSS-->
    <link href="css/animate.css" rel="stylesheet" type="text/css">

    <!--Google Webfonts-->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
</head>

<body>

    <!-- Preloader -->
    <div id="preloader">
        <div id="status" class="la-ball-triangle-path">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <!--End of Preloader-->

    <div class="page-border" data-wow-duration="0.7s" data-wow-delay="0.2s">
        <div class="top-border wow fadeInDown animated" style="visibility: visible; animation-name: fadeInDown;"></div>
        <div class="right-border wow fadeInRight animated" style="visibility: visible; animation-name: fadeInRight;">
        </div>
        <div class="bottom-border wow fadeInUp animated" style="visibility: visible; animation-name: fadeInUp;"></div>
        <div class="left-border wow fadeInLeft animated" style="visibility: visible; animation-name: fadeInLeft;"></div>
    </div>

    <div id="wrapper">

        <header id="banner" class="scrollto clearfix" data-enllax-ratio=".5">
            <div id="header" class="nav-collapse">
                <div class="row clearfix">
                    <div class="col-1">

                        <!--Logo-->
                        <div id="logo">

                            <!--Logo that is shown on the banner-->
                            <img src="images/logo.png" id="banner-logo" alt="Landing Page" />
                            <!--End of Banner Logo-->

                            <!--The Logo that is shown on the sticky Navigation Bar-->
                            <img src="images/logo-2.png" id="navigation-logo" alt="Landing Page" />
                            <!--End of Navigation Logo-->

                        </div>
                        <!--End of Logo-->

                        <aside>

                            <!--Social Icons in Header-->
                            <ul class="social-icons">
                                <li>
                                    <a target="_blank" title="Facebook" href="https://www.facebook.com/username">
                                        <i class="fa fa-facebook fa-1x"></i><span>Facebook</span>
                                    </a>
                                </li>
                            </ul>
                            <!--End of Social Icons in Header-->

                        </aside>

                        <!--Main Navigation-->
                        <nav id="nav-main">
                            <ul>
                                <li>
                                    <a href="#banner">Home</a>
                                </li>
                                <li>
                                    <a href="#map">Map</a>
                                </li>
                                <li>
                                    <a href="#calculator">Calculator</a>
                                </li>
                                <li>
                                    <a href="#results">Results</a>
                                </li>
                            </ul>
                        </nav>
                        <!--End of Main Navigation-->

                        <div id="nav-trigger"><span></span></div>
                        <nav id="nav-mobile"></nav>

                    </div>
                </div>
            </div><!--End of Header-->

            <!--Banner Content-->
            <div id="banner-content" class="row clearfix">

                <div class="col-38">

                    <div class="section-heading">
                        <h1>Transport Cost Calculator</h1>
                        <h2>NaviCity is a free transport cost calculator in Bangkok. Now, its only a matter of modes
                            what you want to embark on...</h2>
                    </div>

                    <!--Call to Action-->
                    <a href="#map" class="button">Start Now</a>
                    <!--End Call to Action-->

                </div>

            </div><!--End of Row-->
        </header>

        <!--Main Content Area-->
        <main id="content">

            <!--Introduction-->
            <section id="map" class="introduction scrollto">

                <div class="row clearfix">

                    <div class="col-3">

                        <div class="map-container">
                            <div class="map" id="map"></div>
                            <div class="formBlock">
                                <form id="form">
                                    <input type="text" name="start" class="input" id="start"
                                        placeholder="Choose starting point" />
                                    <input type="text" name="end" class="input" id="destination"
                                        placeholder="Choose ending point" />
                                    <button style="display: inline-block;" type="submit">Get Directions</button>
                                </form>
                            </div>
                        </div>



                    </div>

                </div>


            </section>
            <!--End of Introduction-->


            <!--Gallery-->
            <aside id="calculator" class="row text-center scrollto clearfix" data-featherlight-gallery
                data-featherlight-filter="a">

                <div class="section-heading">
                    <h3>Calculator</h3>
                    <h2 class="section-title">Time and distance from the map</h2>
                </div>

                <form id="calculatorForm">
                    <label for="distance">Enter distance (in km):</label>
                    <input type="number" id="distance" name="distance" required>

                    <label for="time">Enter estimate traffic time (in seconds):</label>
                    <input type="number" id="time" name="time" required>

                    <button type="button" onclick="calculate()">Calculate</button>
                </form>

            </aside>
            <!--End of Gallery-->


            <!--Pricing Tables-->
            <section id="results" class="secondary-color text-center scrollto clearfix ">
                <div class="row clearfix">

                    <div class="section-heading">
                        <h3>YOUR CHOICE</h3>
                        <h2 class="section-title">Choose what you ride</h2>
                    </div>

                    <!--Pricing Block-->
                    <div class="pricing-block col-3 wow fadeInUp" data-wow-delay="0.4s">
                        <div class="pricing-block-content">
                            <div class="pricing">
                                <div class="price"> Car </div>
                            </div>
                            <ul>
                                <li><strong>Grab Cost:</strong> THB<span id="grabCost"></span></li>
                                <li><strong>JustGrab Cost:</strong> THB<span id="justGrabCost"></span></li>
                                <li><strong>PremiumGrab Cost:</strong> THB<span id="premiumGrabCost"></span></li>
                                <li><strong>Taxi Cost:</strong> THB<span id="taxicost"></span></li>
                                <li><strong>Traffic Cost:</strong> THB<span id="trafficCost"></span></li>
                            </ul>
                        </div>
                    </div>
                    <!--End Pricing Block-->

                    <!--Pricing Block-->
                    <div class="pricing-block featured col-3 wow fadeInUp" data-wow-delay="0.6s">
                        <div class="pricing-block-content">
                            <div class="pricing">
                                <div class="price"> 2-Wheels </div>
                            </div>
                            <ul>
                                <li><strong>Motorcycle Taxi Cost:</strong> THB<span id="mctaxi"></span></li>
                                <li><strong>Grab Bike Cost:</strong> THB<span id="grabbike"></span></li>
                                <li><strong>MC Traffic Cost:</strong> THB<span id="traffic2"></span></li>
                            </ul>
                        </div>
                    </div>
                    <!--End Pricing Block-->

                    <!--Pricing Block-->
                    <div class="pricing-block col-3 wow fadeInUp" data-wow-delay="0.8s">
                        <div class="pricing-block-content">
                            <div class="pricing">
                                <div class="price"> Public Transport </div>
                            </div>
                            <ul>
                                <li>Coming Soon</li>
                            </ul>
                        </div>
                    </div>
                    <!--End Pricing Block-->

                    <a href="#" class="button">BUY TODAY</a>

                </div>
            </section>
            <!--End of Pricing Tables-->

        </main>
        <!--End Main Content Area-->

    </div>

    <!-- Include JavaScript resources -->
    <script src="js/jquery.1.8.3.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/featherlight.min.js"></script>
    <script src="js/featherlight.gallery.min.js"></script>
    <script src="js/jquery.enllax.min.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/jquery.stickyNavbar.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/images-loaded.min.js"></script>
    <script src="js/lightbox.min.js"></script>
    <script src="js/site.js"></script>
    <script>
        function calculate() {
            // Get user input
            const distance = parseFloat(document.getElementById('distance').value);
            const time = parseFloat(document.getElementById('time').value);

            // Perform calculations
            const results = multipleFunc(distance, time);

            // Display the results
            document.getElementById('grabCost').textContent = results.Grab.toFixed(2);
            document.getElementById('justGrabCost').textContent = results.JustGrab.toFixed(2);
            document.getElementById('premiumGrabCost').textContent = results.PremiumGrab.toFixed(2);
            document.getElementById('trafficCost').textContent = results.TrafficCost.toFixed(2);
            document.getElementById('traffic2').textContent = results.TrafficCostMC.toFixed(2);
            document.getElementById('taxicost').textContent = results.NormalTaxi.toFixed(2);
            document.getElementById('mctaxi').textContent = results.MCTaxi.toFixed(2);
            document.getElementById('grabbike').textContent = results.GrabBike.toFixed(2);
        }

        function multipleFunc(x, y) {
            return {
                Grab: calculateGrabCost(x),
                JustGrab: calculateJustGrabCost(x),
                PremiumGrab: calculateGrabPremCost(x),
                NormalTaxi: calculateTaxiCost(x),
                TrafficCost: calculateJamCost(y),
                TrafficCostMC: calculateJamCost2(y),
                MCTaxi: calculateMCTaxiCost(x),
                GrabBike: calculateGrabBikeCost(x)
            };
        }

        function calculateGrabCost(distance) {
            let cost;
            if (distance >= 0 && distance <= 2) {
                cost = 45;
            } else if (distance > 2 && distance <= 6) {
                cost = 45 + 8 * (distance - 2);
            } else if (distance > 6 && distance <= 40) {
                cost = 45 + 8 * (6 - 2) + 7 * (distance - 6);
            } else {
                cost = 45 + 8 * (6 - 2) + 7 * (40 - 6) + 10 * (distance - 40);
            }
            cost += 20;
            return cost;
        }


        function calculateJustGrabCost(distance) {
            let cost;
            if (distance >= 0 && distance <= 2) {
                cost = 45;
            } else if (distance > 2 && distance <= 40) {
                cost = 45 + 7 * (distance - 2);
            } else {
                cost = 45 + 7 * (40 - 2) + 10 * (distance - 40);
            }
            cost += 20;
            return cost;
        }

        function calculateGrabPremCost(distance) {
            let cost;
            if (distance >= 0 && distance <= 2) {
                cost = 110;
            } else {
                cost = 45 + 12 * (distance - 2);
            }
            cost += 20;
            return cost;
        }

        function calculateTaxiCost(distance) {
            let cost;
            if (distance >= 0 && distance <= 1) {
                cost = 40;
            } else if (distance > 1 && distance <= 10) {
                cost = 40 + 6.5 * (distance - 1);
            } else if (distance > 10 && distance <= 20) {
                cost = 40 + 6.5 * (10 - 1) + 7 * (distance - 10);
            } else if (distance > 20 && distance <= 40) {
                cost = 40 + 6.5 * (10 - 1) + 7 * (20 - 10) + 8 * (distance - 20);
            } else if (distance > 40 && distance <= 80) {
                cost = 40 + 6.5 * (10 - 1) + 7 * (20 - 10) + 8 * (40 - 20) + 9 * (distance - 40);
            } else {
                cost = 40 + 6.5 * (10 - 1) + 7 * (20 - 10) + 8 * (40 - 20) + 9 * (80 - 40) + 10.5 * (distance - 80);
            }
            cost += 5;
            return cost;
        }

        function calculateMCTaxiCost(distance) {
            let cost;
            if (distance >= 0 && distance <= 2) {
                cost = 25;
            } else if (distance > 2 && distance <= 5) {
                cost = 25 + 6 * (distance - 2);
            } else if (distance > 5 && distance <= 15) {
                cost = 25 + 6 * (5 - 2) + 10 * (distance - 5);
            } else {
                cost = 25 + 6 * (5 - 2) + 12 * (distance - 5);
            }
            cost += 5;
            return cost;
        }

        function calculateGrabBikeCost(distance) {
            let cost;
            if (distance >= 0 && distance <= 2) {
                cost = 25;
            } else if (distance > 2 && distance <= 5) {
                cost = 25 + 6 * (distance - 2);
            } else if (distance > 5 && distance <= 15) {
                cost = 50 + 10 * (distance - 5);
            } else {
                cost = 50 + 10 * (15 - 5) + 15 * (distance - 15);
            }
            cost += 5;
            return cost;
        }


        function calculateJamCost(time) {
            return time/20;
        }

        function calculateJamCost2(time) {
            return time/30;
        }

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
    <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=nyx6iFJXfTlFmLdu6Ev3aB2Nv1Gt0btS"></script>
    <script
        src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=nyx6iFJXfTlFmLdu6Ev3aB2Nv1Gt0btS"></script>
    <script>

        const form = document.getElementById('form');
        let currentMarkerTarget = document.getElementById("start")

        var map = L.map('map').setView([13.745742, 100.498810], 12);

        const pinningLayer = L.layerGroup().addTo(map)

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // var markers = [];
        var markers = {
            start: null,
            end: null,
        }

        map.on('click', function (e) {
            if (e.originalEvent.target.form) {
                L.DomEvent.stopPropagation(e.originalEvent);
                return
            }
            var coordinates = e.latlng;
            // document.querySelector('.marked-container').style.display = '';

            var lat = coordinates.lat.toFixed(6);
            var long = coordinates.lng.toFixed(6);
            saveMarker(lat, long)
        });

        function closeMarkerContainer() {
            document.querySelector('.marked-container').style.display = 'none';
            document.querySelector('.map-container').style.width = '100%';
        }

        function saveMarker(latitude, longitude) {

            const markerName = currentMarkerTarget.name
            console.log("Marker Name:", markerName);
            console.log("Latitude:", latitude);
            console.log("Longitude:", longitude);



            if (markerName && latitude && longitude) {
                var marker = {
                    name: markerName,
                    lat: latitude,
                    lng: longitude
                };

                currentMarkerTarget.value = latitude + " " + longitude

                // markers.push(marker);
                markers[markerName] = marker
                updateMarkedLocations();
            } else {
                alert('Please fill in all the fields.');
            }
        }

        function updateMarkedLocations() {
            // var markedLocationsList = document.getElementById('markedLocations');
            // markedLocationsList.innerHTML = '';
            pinningLayer.clearLayers();
            Object.values(markers).forEach(function (marker) {
                // var listItem = document.createElement('li');
                // listItem.innerHTML = `<div>${marker.name} <button onclick="viewLocation(${marker.lat}, ${marker.lng})">View Location</button></div>`;
                // markedLocationsList.appendChild(listItem);
                console.log(marker)
                if (marker != null) L.marker([marker.lat, marker.lng]).addTo(pinningLayer)
                    .bindPopup(marker.name).openPopup();
            });

            // // Clear input values after saving
            // document.getElementById('markerName').value = '';
            // document.getElementById('latitude').value = '';
            // document.getElementById('longitude').value = '';
        }

        function viewLocation(lat, lng) {
            map.panTo(new L.LatLng(lat, lng));
        }
        function runDirection(start, end) {

            // recreating new map layer after removal


            const [startLat, startLong] = start.split(" ")
            const [endLat, endLong] = end.split(" ")
            // dir = MQ.routing.directions();
            // L.mapquest.directions().route({

            //     start: L.latLng(startLat, startLong),
            //     end: L.latLng(endLat, endLong)

            // })
            map = L.map('map', {
                layers: MQ.mapLayer(),
                center: [startLat, startLong],
                zoom: 12
            });

            var dir = MQ.routing.directions().on('success', function (data) {
                console.log(data);
                if (data.route.distance) document.getElementById('distance').value = data.route.distance
                if (data.route.realTime) document.getElementById('time').value = data.route.realTime
            });


            dir.route({
                locations: [
                    { latLng: { lat: startLat, lng: startLong } },
                    { latLng: { lat: endLat, lng: endLong } },
                ]
            });


            // CustomRouteLayer = MQ.Routing.RouteLayer.extend();

            map.addLayer(MQ.routing.routeLayer({
                directions: dir,
                fitBounds: true
            }));
        }
        function submitForm(event) {
            event.preventDefault();

            // delete current map layer
            map.remove();

            // getting form data
            start = document.getElementById("start").value;
            end = document.getElementById("destination").value;

            // run directions function
            runDirection(start, end);

            // reset form
            // document.getElementById("form").reset();
        }

        function setFocusTarget(event) {
            // console.log(event)
            currentMarkerTarget = event.srcElement
            // console.log(currentMarkerTarget)
        }

        const startInput = document.getElementById("start")
        const destInput = document.getElementById("destination")

        startInput.addEventListener("click", setFocusTarget)
        destInput.addEventListener("click", setFocusTarget)

        // asign the form to form variable


        // call the submitForm() function when submitting the form
        form.addEventListener('submit', submitForm);
    </script>

</body>

</html>